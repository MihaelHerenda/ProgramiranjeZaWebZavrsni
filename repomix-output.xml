This file is a merged representation of a subset of the codebase, containing files not matching ignore patterns, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of a subset of the repository's contents that is considered the most important context.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching these patterns are excluded: node_modules, venv, __pycache__, migrations, media, db.sqlite3
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
manage.py
moj_app/__init__.py
moj_app/admin.py
moj_app/apps.py
moj_app/factories.py
moj_app/forms.py
moj_app/management/commands/__init__.py
moj_app/management/commands/setup_test_data.py
moj_app/migrations/__init__.py
moj_app/migrations/0001_initial.py
moj_app/models.py
moj_app/tests.py
moj_app/urls.py
moj_app/views.py
moj_projekt/__init__.py
moj_projekt/.gitignore
moj_projekt/asgi.py
moj_projekt/settings.py
moj_projekt/urls.py
moj_projekt/wsgi.py
README.md
templates/base.html
templates/posts/post_detail.html
templates/posts/post_form.html
templates/posts/post_list.html
templates/registration/login.html
templates/registration/register.html
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="manage.py">
#!/usr/bin/env python
"""Django's command-line utility for administrative tasks."""
import os
import sys


def main():
    """Run administrative tasks."""
    os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'moj_projekt.settings')
    try:
        from django.core.management import execute_from_command_line
    except ImportError as exc:
        raise ImportError(
            "Couldn't import Django. Are you sure it's installed and "
            "available on your PYTHONPATH environment variable? Did you "
            "forget to activate a virtual environment?"
        ) from exc
    execute_from_command_line(sys.argv)


if __name__ == '__main__':
    main()
</file>

<file path="moj_app/__init__.py">

</file>

<file path="moj_app/admin.py">
from django.contrib import admin

# Register your models here.
</file>

<file path="moj_app/apps.py">
from django.apps import AppConfig


class MojAppConfig(AppConfig):
    default_auto_field = 'django.db.models.BigAutoField'
    name = 'moj_app'
</file>

<file path="moj_app/factories.py">
import factory
from django.contrib.auth.models import User
from .models import Post, Comment, Like
from factory.django import DjangoModelFactory


class UserFactory(DjangoModelFactory):
    class Meta:
        model = User
    
    username = factory.Faker('user_name')
    email = factory.Faker('email')
    password = factory.PostGenerationMethodCall('set_password', 'pass123')


class PostFactory(DjangoModelFactory):
    class Meta:
        model = Post
    
    title = factory.Faker('sentence', nb_words=4)
    content = factory.Faker('paragraph', nb_sentences=5)
    author = factory.SubFactory(UserFactory)


class CommentFactory(DjangoModelFactory):
    class Meta:
        model = Comment
    
    post = factory.SubFactory(PostFactory)
    author = factory.SubFactory(UserFactory)
    content = factory.Faker('sentence', nb_words=10)


class LikeFactory(DjangoModelFactory):
    class Meta:
        model = Like
        django_get_or_create = ('user', 'post')

    post = factory.SubFactory(PostFactory)
    user = factory.SubFactory(UserFactory)
</file>

<file path="moj_app/management/commands/__init__.py">

</file>

<file path="moj_app/management/commands/setup_test_data.py">
import random
from django.db import transaction
from django.core.management.base import BaseCommand
from moj_app.models import Post, Comment, Like, User
from moj_app.factories import UserFactory, PostFactory, CommentFactory, LikeFactory

class Command(BaseCommand):
    help = "Generira testne podatke koristeći Factory Boy"

    @transaction.atomic
    def handle(self, *args, **kwargs):
        self.stdout.write("Brisanje starih podataka...")
        Like.objects.all().delete()
        Comment.objects.all().delete()
        Post.objects.all().delete()
        User.objects.exclude(is_superuser=True).delete() # Čuvamo admina

        self.stdout.write("Kreiranje novih podataka...")

        
        users = UserFactory.create_batch(10)

        
        for _ in range(30):
            author = random.choice(users)
            post = PostFactory(author=author)

            
            for _ in range(random.randint(0, 5)):
                comment_author = random.choice(users)
                CommentFactory(post=post, author=comment_author)

            
            likers = random.sample(users, random.randint(0, 8))
            for liker in likers:
                LikeFactory(post=post, user=liker)

        self.stdout.write(self.style.SUCCESS("Uspješno generirano: 10 korisnika, 30 postova + komentari i lajkovi!"))
</file>

<file path="moj_app/migrations/__init__.py">

</file>

<file path="moj_app/migrations/0001_initial.py">
# Generated by Django 6.0.1 on 2026-01-31 19:11

import django.db.models.deletion
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='Post',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('title', models.CharField(max_length=200, verbose_name='Naslov')),
                ('content', models.TextField(verbose_name='Sadržaj')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('author', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='posts', to=settings.AUTH_USER_MODEL)),
            ],
        ),
        migrations.CreateModel(
            name='Comment',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('content', models.TextField(verbose_name='Komentar')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('author', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('post', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='comments', to='moj_app.post')),
            ],
            options={
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='Like',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),
                ('post', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='likes', to='moj_app.post')),
            ],
            options={
                'unique_together': {('user', 'post')},
            },
        ),
    ]
</file>

<file path="moj_projekt/__init__.py">

</file>

<file path="moj_projekt/.gitignore">
venv/
*.pyc
__pycache__/
db.sqlite3
.DS_Store
</file>

<file path="moj_projekt/asgi.py">
"""
ASGI config for moj_projekt project.

It exposes the ASGI callable as a module-level variable named ``application``.

For more information on this file, see
https://docs.djangoproject.com/en/5.2/howto/deployment/asgi/
"""

import os

from django.core.asgi import get_asgi_application

os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'moj_projekt.settings')

application = get_asgi_application()
</file>

<file path="moj_projekt/wsgi.py">
"""
WSGI config for moj_projekt project.

It exposes the WSGI callable as a module-level variable named ``application``.

For more information on this file, see
https://docs.djangoproject.com/en/5.2/howto/deployment/wsgi/
"""

import os

from django.core.wsgi import get_wsgi_application

os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'moj_projekt.settings')

application = get_wsgi_application()
</file>

<file path="moj_app/forms.py">
from django import forms
from .models import Post, Comment  

class PostForm(forms.ModelForm):
    class Meta:
        model = Post
        fields = ['title', 'content']
        widgets = {
            'title': forms.TextInput(attrs={'class': 'form-control', 'placeholder': 'Naslov ideje'}),
            'content': forms.Textarea(attrs={'class': 'form-control', 'rows': 4, 'placeholder': 'Opišite svoju ideju...'}),
        }

class CommentForm(forms.ModelForm):
    class Meta:
        model = Comment
        fields = ['content']
        widgets = {
            'content': forms.Textarea(attrs={
                'class': 'form-control', 
                'rows': 2, 
                'placeholder': 'Napiši svoj komentar...'
            }),
        }
</file>

<file path="moj_app/models.py">
from django.db import models
from django.contrib.auth.models import User

class Post(models.Model):
    title = models.CharField(max_length=200, verbose_name="Naslov")
    content = models.TextField(verbose_name="Sadržaj")
    author = models.ForeignKey(User, on_delete=models.CASCADE, related_name='posts')
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)

    def __str__(self):
        return self.title

    def total_likes(self):
        return self.likes.count()

class Comment(models.Model):
    post = models.ForeignKey(Post, on_delete=models.CASCADE, related_name='comments')
    # Ovdje je ključ: on_delete=models.SET_NULL čuva komentar čak i ako se autor obriše
    author = models.ForeignKey(User, on_delete=models.SET_NULL, null=True, blank=True)
    content = models.TextField(verbose_name="Komentar")
    created_at = models.DateTimeField(auto_now_add=True)

    class Meta:
        ordering = ['-created_at'] # Najnoviji komentari prvi

    def __str__(self):
        return f"Komentar na {self.post.title}"

    # Ovo koristiš u HTML-u kao {{ comment.display_author }}
    @property
    def display_author(self):
        if self.author:
            return self.author.username
        return "Obrisani korisnik"

class Like(models.Model):
    user = models.ForeignKey(User, on_delete=models.CASCADE)
    post = models.ForeignKey(Post, on_delete=models.CASCADE, related_name='likes')
    created_at = models.DateTimeField(auto_now_add=True)

    class Meta:
        # Ovo sprječava da isti korisnik lajka isti post više puta
        unique_together = ('user', 'post')

    def __str__(self):
        return f"{self.user.username} likes {self.post.title}"
</file>

<file path="moj_app/tests.py">
from django.test import TestCase, Client
from django.urls import reverse
from .models import Post, Comment
from .factories import UserFactory, PostFactory, CommentFactory

class ProjectTests(TestCase):
    def setUp(self):
        self.client = Client()
        
        self.user = UserFactory(username='testni_korisnik', password='password123')

    def test_post_model_str(self):
        """Testira vraća li model ispravan naziv (string representation)"""
        post = PostFactory(title="Naslov posta")
        self.assertEqual(str(post), "Naslov posta")

    def test_homepage_view(self):
        """Testira učitava li se naslovnica i vide li se postovi"""
        
        PostFactory.create_batch(3)
        
        response = self.client.get(reverse('post_list'))
        
        self.assertEqual(response.status_code, 200)
        
        self.assertEqual(len(response.context['posts']), 3)

    def test_post_detail_view(self):
        """Testira radi li pojedinačni prikaz posta"""
        post = PostFactory(title="Detaljni naslov", content="Neki sadržaj")
        
        response = self.client.get(reverse('post_detail', args=[post.pk]))
        
        self.assertEqual(response.status_code, 200)
        self.assertContains(response, "Detaljni naslov")
        self.assertContains(response, "Neki sadržaj")

    def test_create_post_authenticated(self):
        """Testira može li logirani korisnik stvoriti post"""
        self.client.force_login(self.user) 
        
        data = {
            'title': 'Novi testni post',
            'content': 'Sadržaj novog posta'
        }
        
        response = self.client.post(reverse('post_create'), data)
        
        self.assertEqual(response.status_code, 302)
        
        self.assertTrue(Post.objects.filter(title='Novi testni post').exists())
</file>

<file path="moj_app/urls.py">
from django.contrib import admin
from django.urls import path, include

urlpatterns = [
    path('admin/', admin.site.urls),
    path('main/', include('main.urls')),
]
</file>

<file path="moj_projekt/settings.py">
"""
Django settings for moj_projekt project.

Generated by 'django-admin startproject' using Django 5.2.7.

For more information on this file, see
https://docs.djangoproject.com/en/5.2/topics/settings/

For the full list of settings and their values, see
https://docs.djangoproject.com/en/5.2/ref/settings/
"""

from pathlib import Path

# Build paths inside the project like this: BASE_DIR / 'subdir'.
BASE_DIR = Path(__file__).resolve().parent.parent


# Quick-start development settings - unsuitable for production
# See https://docs.djangoproject.com/en/5.2/howto/deployment/checklist/

# SECURITY WARNING: keep the secret key used in production secret!
SECRET_KEY = 'django-insecure-d=vz_7@&emnxf=3to+hh#7=4p++(&(7%h-t_*)h!_-mzre8kf7'

# SECURITY WARNING: don't run with debug turned on in production!
DEBUG = True

ALLOWED_HOSTS = []


# Application definition

INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'moj_app.apps.MojAppConfig'
]

MIDDLEWARE = [
    'django.middleware.security.SecurityMiddleware',
    'django.contrib.sessions.middleware.SessionMiddleware',
    'django.middleware.common.CommonMiddleware',
    'django.middleware.csrf.CsrfViewMiddleware',
    'django.contrib.auth.middleware.AuthenticationMiddleware',
    'django.contrib.messages.middleware.MessageMiddleware',
    'django.middleware.clickjacking.XFrameOptionsMiddleware',
]

ROOT_URLCONF = 'moj_projekt.urls'

TEMPLATES = [
    {
        'BACKEND': 'django.template.backends.django.DjangoTemplates',
        'DIRS': [BASE_DIR / 'templates'],
        'APP_DIRS': True,
        'OPTIONS': {
            'context_processors': [
                'django.template.context_processors.request',
                'django.contrib.auth.context_processors.auth',
                'django.contrib.messages.context_processors.messages',
            ],
        },
    },
]

WSGI_APPLICATION = 'moj_projekt.wsgi.application'


# Database
# https://docs.djangoproject.com/en/5.2/ref/settings/#databases

DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.sqlite3',
        'NAME': BASE_DIR / 'db.sqlite3',
    }
}


# Password validation
# https://docs.djangoproject.com/en/5.2/ref/settings/#auth-password-validators

AUTH_PASSWORD_VALIDATORS = [
    {
        'NAME': 'django.contrib.auth.password_validation.UserAttributeSimilarityValidator',
    },
    {
        'NAME': 'django.contrib.auth.password_validation.MinimumLengthValidator',
    },
    {
        'NAME': 'django.contrib.auth.password_validation.CommonPasswordValidator',
    },
    {
        'NAME': 'django.contrib.auth.password_validation.NumericPasswordValidator',
    },
]


# Internationalization
# https://docs.djangoproject.com/en/5.2/topics/i18n/

LANGUAGE_CODE = 'en-us'

TIME_ZONE = 'UTC'

USE_I18N = True

USE_TZ = True


# Static files (CSS, JavaScript, Images)
# https://docs.djangoproject.com/en/5.2/howto/static-files/

STATIC_URL = 'static/'

# Default primary key field type
# https://docs.djangoproject.com/en/5.2/ref/settings/#default-auto-field

DEFAULT_AUTO_FIELD = 'django.db.models.BigAutoField'

LOGIN_REDIRECT_URL = 'post_list'
LOGOUT_REDIRECT_URL = 'post_list'
</file>

<file path="README.md">
# ProgramiranjeZaWebZavrsni
Repozitorij za završni ispit iz predmeta Programiranje za Web

Zadatak: Platforma za dijeljenje ideja
Autori: Mihael Herenda i Lisa Julia Hozjan
</file>

<file path="templates/posts/post_form.html">
{% extends 'base.html' %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8 col-lg-6">
        <div class="card shadow">
            <div class="card-header bg-primary text-white">
                <h4 class="mb-0"><i class="fas fa-pen"></i> Nova ideja</h4>
            </div>
            <div class="card-body p-4">
                <form method="post">
                    {% csrf_token %}
                    
                    <!-- Ručno renderiranje forme bi bilo bolje, ali CSS u base.html će ovo popraviti -->
                    {{ form.as_p }}
                    
                    <div class="d-grid gap-2 mt-4">
                        <button type="submit" class="btn btn-primary btn-lg">Objavi ideju</button>
                        <a href="{% url 'post_list' %}" class="btn btn-outline-secondary">Odustani</a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}
</file>

<file path="templates/base.html">
<!DOCTYPE html>
<html lang="hr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Platforma za Ideje</title>
    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary-color: #4f46e5;
            --primary-hover: #4338ca;
            --bg-color: #f9fafb;
            --nav-bg: #1f2937;
        }

        body {
            background-color: var(--bg-color);
            font-family: 'Inter', sans-serif;
            color: #1f2937;
            padding-top: 70px; 
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .navbar {
            background-color: var(--nav-bg) !important;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
            padding: 0.6rem 0;
        }
        
        .navbar-brand {
            font-weight: 700;
            font-size: 1.35rem;
            letter-spacing: -0.025em;
            color: white !important;
        }

        .navbar-brand i {
            color: #818cf8; 
        }

        .nav-link {
            color: #e5e7eb !important;
            font-weight: 500;
        }
        
        .nav-link:hover {
            color: white !important;
        }

        .main-container {
            width: 100%;
            max-width: 900px;
            margin: 0 auto;
            padding: 1.5rem 1rem;
            flex: 1;
        }

        .form-control {
            padding: 0.6rem 1rem;
            border-radius: 0.5rem;
            border: 1px solid #d1d5db;
        }
        .form-control:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.15);
        }

        .btn-primary {
            background-color: var(--primary-color);
            border: none;
        }
        .btn-primary:hover {
            background-color: var(--primary-hover);
        }
    </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container">
            <a class="navbar-brand d-flex align-items-center gap-2" href="{% url 'post_list' %}">
                <i class="fas fa-lightbulb"></i> Moje Ideje
            </a>
            
            <button class="navbar-toggler border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarContent">
                <ul class="navbar-nav ms-auto align-items-lg-center gap-2 mt-3 mt-lg-0">
                    
                    {% if user.is_authenticated %}
                        <li class="nav-item">
                            <span class="nav-link disabled text-white-50">
                                <i class="far fa-user me-1"></i> {{ user.username }}
                            </span>
                        </li>
                        <li class="nav-item">
                            <a href="{% url 'post_create' %}" class="btn btn-primary btn-sm rounded-pill px-4 w-100 fw-bold">
                                <i class="fas fa-plus me-1"></i> Nova ideja
                            </a>
                        </li>
                        <li class="nav-item">
                            <form action="{% url 'logout' %}" method="post" class="d-flex">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-outline-light btn-sm rounded-pill px-3 w-100">
                                    <i class="fas fa-sign-out-alt me-1"></i> Odjava
                                </button>
                            </form>
                        </li>
                    {% else %}
                        <li class="nav-item">
                            <a class="btn btn-outline-light btn-sm rounded-pill px-4 w-100" href="{% url 'login' %}">Prijava</a>
                        </li>
                        <li class="nav-item">
                            <a class="btn btn-primary btn-sm rounded-pill px-4 w-100 fw-bold" href="{% url 'register' %}">Registracija</a>
                        </li>
                    {% endif %}
                    
                </ul>
            </div>
        </div>
    </nav>

    <div class="main-container">
        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }} alert-dismissible fade show rounded-3 shadow-sm mb-4" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            {% endfor %}
        {% endif %}

        {% block content %}
        {% endblock %}
    </div>

    <!-- JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
</file>

<file path="templates/posts/post_list.html">
{% extends 'base.html' %}

{% block content %}
<div class="row mb-4 align-items-center">
    <div class="col-md-6">
        <h2 class="fw-bold m-0 text-dark">Najnovije objave</h2>
    </div>
    <div class="col-md-6">
        
        <form method="get" action="{% url 'post_list' %}">
            <div class="input-group">
                <input type="text" name="q" class="form-control rounded-start-pill border-end-0" placeholder="Pretraži po naslovu ili sadržaju..." value="{{ query|default:'' }}">
                <button class="btn btn-primary rounded-end-pill px-4" type="submit">
                    <i class="fas fa-search"></i>
                </button>
                {% if query %}
                   
                    <a href="{% url 'post_list' %}" class="btn btn-light ms-2 rounded-circle" title="Poništi">
                        <i class="fas fa-times"></i>
                    </a>
                {% endif %}
            </div>
        </form>
    </div>
</div>


<div class="row g-4">
    {% for post in posts %}
    <div class="col-12">
        
        <div class="card border-0 custom-card h-100 position-relative">
            <div class="card-body p-4">
                <div class="d-flex align-items-center mb-3">
                    
                    <div class="avatar-box me-3">
                        <span class="fw-bold">{{ post.author.username|slice:":1"|upper }}</span>
                    </div>
                    <div>
                        <h6 class="mb-0 fw-bold text-dark">{{ post.author.username }}</h6>
                        <small class="text-muted">{{ post.created_at|date:"d. M Y." }}</small>
                    </div>
                </div>
                
                
                <a href="{% url 'post_detail' post.pk %}" class="text-decoration-none stretched-link">
                    <h4 class="fw-bold text-dark mb-2 card-title-hover">{{ post.title }}</h4>
                    <p class="text-secondary mb-0" style="line-height: 1.6;">
                        {{ post.content|truncatewords:40 }}
                    </p>
                </a>
            </div>
            
            
            <div class="card-footer bg-transparent border-top p-3">
                <div class="d-flex align-items-center text-muted small">
                    <span class="me-4"><i class="far fa-heart me-1"></i> {{ post.total_likes }}</span>
                    <span><i class="far fa-comment me-1"></i> {{ post.comments.count }}</span>
                    <span class="ms-auto text-primary opacity-0 arrow-icon">
                        <i class="fas fa-arrow-right"></i>
                    </span>
                </div>
            </div>
        </div>
    </div>
    {% empty %}
    <div class="text-center py-5">
        <div class="mb-3 text-muted opacity-50">
            <i class="fas fa-wind fa-3x"></i>
        </div>
        <h4>Nema rezultata...</h4>
        <p class="text-muted">Pokušajte promijeniti pojam pretrage ili objavite novu ideju!</p>
        {% if query %}
            <a href="{% url 'post_list' %}" class="btn btn-outline-primary mt-2">Prikaži sve</a>
        {% endif %}
    </div>
    {% endfor %}
</div>

<style>
    .custom-card {
        background: white;
        border-radius: 12px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        transition: all 0.2s ease-in-out;
        overflow: hidden;
    }
    .custom-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
    }
    .avatar-box {
        width: 45px;
        height: 45px;
        background: #e0e7ff;
        color: #4f46e5;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    .custom-card:hover .card-title-hover {
        color: var(--primary-color);
    }
    .custom-card:hover .arrow-icon {
        opacity: 1 !important;
        transition: opacity 0.2s;
    }
</style>
{% endblock %}
</file>

<file path="templates/registration/login.html">
{% extends 'base.html' %}

{% block content %}
<div class="row justify-content-center align-items-center mt-5">
    <div class="col-12 col-md-7 col-lg-5">
        <div class="card border-0 shadow-lg rounded-4 p-4">
            <div class="card-body">
                <div class="text-center mb-4">
                    <h3 class="fw-bold">Dobrodošli natrag</h3>
                    <p class="text-muted small">Unesite svoje podatke za pristup</p>
                </div>
                
                <form method="post">
                    {% csrf_token %}
                    
                    {% for field in form %}
                        <div class="mb-3">
                            <label class="form-label small fw-bold text-uppercase text-muted">{{ field.label }}</label>
                            <!-- Input polja -->
                            {{ field }} 
                            {% if field.errors %}
                                <div class="text-danger small mt-1">{{ field.errors.0 }}</div>
                            {% endif %}
                        </div>
                    {% endfor %}
                    
                    <div class="d-grid mt-4">
                        <button type="submit" class="btn btn-primary btn-lg fs-6 fw-bold">Prijavi se</button>
                    </div>
                </form>

                <div class="text-center mt-4 pt-3 border-top">
                    <small class="text-muted">Nemate račun?</small>
                    <a href="{% url 'register' %}" class="fw-bold text-decoration-none ms-1" style="color: var(--primary-color);">Registrirajte se</a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
</file>

<file path="templates/registration/register.html">
{% extends 'base.html' %}

{% block content %}
<div class="row justify-content-center mt-5">
    <!-- Popravljene širine stupaca -->
    <div class="col-12 col-md-8 col-lg-6">
        <div class="card shadow-lg border-0 rounded-4">
            <div class="card-body p-5">
                <div class="text-center mb-4">
                    <div class="mb-3 text-success">
                        <i class="fas fa-user-plus fa-3x"></i>
                    </div>
                    <h2 class="fw-bold">Registracija</h2>
                    <p class="text-muted">Pridruži se zajednici</p>
                </div>
                
                <form method="post">
                    {% csrf_token %}
                    
                    {% for field in form %}
                        <div class="mb-3">
                            <label class="form-label small fw-bold text-uppercase text-muted">{{ field.label }}</label>
                            {{ field }}
                            {% if field.errors %}
                                <div class="text-danger small mt-1">{{ field.errors.0 }}</div>
                            {% endif %}
                        </div>
                    {% endfor %}
                    
                    <div class="d-grid mt-4">
                        <button type="submit" class="btn btn-success btn-lg fw-bold">Registriraj se</button>
                    </div>
                </form>
            </div>
            <div class="card-footer text-center py-3 bg-light border-0 rounded-bottom-4">
                <small>Već imaš račun? <a href="{% url 'login' %}" class="fw-bold text-decoration-none">Prijavi se</a></small>
            </div>
        </div>
    </div>
</div>
{% endblock %}
</file>

<file path="templates/posts/post_detail.html">
{% extends 'base.html' %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-10">
        
        <a href="{% url 'post_list' %}" class="btn btn-light btn-sm mb-4 rounded-pill px-3">
            <i class="fas fa-arrow-left me-1"></i> Natrag
        </a>

        
        <div class="card border-0 shadow-sm rounded-4 overflow-hidden mb-5">
            <div class="card-body p-4 p-lg-5">
                
                
                <div class="d-flex justify-content-between align-items-start mb-4 pb-3 border-bottom">
                    <div class="d-flex align-items-center">
                        <div class="bg-dark text-white rounded-3 d-flex align-items-center justify-content-center me-3" style="width: 50px; height: 50px;">
                            <span class="fs-4">{{ post.author.username|slice:":1"|upper }}</span>
                        </div>
                        <div>
                            <div class="fw-bold">{{ post.author.username }}</div>
                            <div class="text-muted small">Objavljeno {{ post.created_at|date:"d.m.Y" }}</div>
                        </div>
                    </div>

                    
                    {% if user == post.author %}
                        <div>
                            <a href="{% url 'post_edit' post.pk %}" class="btn btn-outline-primary btn-sm rounded-pill me-1" title="Uredi objavu">
                                <i class="fas fa-edit"></i> <span class="d-none d-sm-inline">Uredi</span>
                            </a>
                            <a href="{% url 'post_delete' post.pk %}" class="btn btn-outline-danger btn-sm rounded-pill" onclick="return confirm('Jeste li sigurni da želite obrisati ovu ideju? Ovo se ne može poništiti.');" title="Obriši objavu">
                                <i class="fas fa-trash-alt"></i> <span class="d-none d-sm-inline">Obriši</span>
                            </a>
                        </div>
                    {% endif %}
                </div>

                
                <h1 class="display-6 fw-bold mb-4">{{ post.title }}</h1>
                
                <div class="content-body fs-5 text-secondary" style="line-height: 1.8;">
                    {{ post.content|linebreaks }}
                </div>
            </div>
            
            
            <div class="card-footer bg-light p-4 border-top-0">
                
                
                <div class="mb-4">
                    {% if user.is_authenticated %}
                        <form action="{% url 'like_post' post.pk %}" method="POST">
                            {% csrf_token %}
                            <button type="submit" class="btn {% if is_liked %}btn-danger{% else %}btn-outline-danger{% endif %} rounded-pill px-4">
                                <i class="{% if is_liked %}fas{% else %}far{% endif %} fa-heart me-1"></i> 
                                {% if is_liked %}Sviđa mi se{% else %}Lajkaj{% endif %} 
                                <span class="ms-1 fw-bold">({{ post.total_likes }})</span>
                            </button>
                        </form>
                    {% else %}
                        <a href="{% url 'login' %}" class="btn btn-outline-danger rounded-pill px-4">
                            <i class="far fa-heart me-1"></i> Lajkaj ({{ post.total_likes }})
                        </a>
                    {% endif %}
                </div>

                <hr class="text-muted opacity-25 my-4">

                <h5 class="fw-bold mb-4">
                    <i class="far fa-comments me-2"></i>Komentari ({{ comments.count }})
                </h5>
                
                
                {% if user.is_authenticated %}
                    <div class="mb-5">
                        <form method="post">
                            {% csrf_token %}
                            <div class="d-flex gap-2 align-items-start">
                                <div class="flex-grow-1">
                                    {{ form.content }}
                                </div>
                                <button type="submit" class="btn btn-primary px-4 py-2">
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                            </div>
                        </form>
                    </div>
                {% else %}
                    <div class="alert alert-secondary rounded-3 mb-4 text-center">
                        Molimo <a href="{% url 'login' %}" class="fw-bold">prijavite se</a> ako želite komentirati.
                    </div>
                {% endif %}

                <!-- Lista postojećih komentara -->
                <div class="comments-list">
                    {% for comment in comments %}
                        <div class="d-flex gap-3 mb-3">
                            <div class="bg-secondary text-white rounded-circle d-flex align-items-center justify-content-center flex-shrink-0" style="width: 40px; height: 40px;">
                                {{ comment.display_author|slice:":1"|upper }}
                            </div>
                            <div class="bg-white p-3 rounded-4 shadow-sm w-100 border">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <strong class="text-dark">{{ comment.display_author }}</strong>
                                    <small class="text-muted" style="font-size: 0.8rem;">{{ comment.created_at|date:"d.m.Y H:i" }}</small>
                                </div>
                                <p class="mb-0 text-secondary" style="white-space: pre-wrap;">{{ comment.content }}</p>
                            </div>
                        </div>
                    {% empty %}
                        <div class="text-center py-4 text-muted opacity-75">
                            <i class="far fa-comment-dots fa-2x mb-2"></i>
                            <p>Još nema komentara. Budite prvi koji će podijeliti mišljenje!</p>
                        </div>
                    {% endfor %}
                </div>

            </div>
        </div>
    </div>
</div>
{% endblock %}
</file>

<file path="moj_app/views.py">
from django.shortcuts import render, redirect, get_object_or_404
from django.urls import reverse_lazy
from django.contrib.auth.forms import UserCreationForm
from django.contrib.auth import login
from django.db.models import Q
from django.views.generic import ListView, DetailView, CreateView, UpdateView, DeleteView
from django.views.generic.edit import FormMixin
from django.contrib.auth.mixins import LoginRequiredMixin, UserPassesTestMixin
from .models import Post, Like, Comment
from .forms import PostForm, CommentForm

def register(request):
    if request.method == 'POST':
        form = UserCreationForm(request.POST)
        if form.is_valid():
            user = form.save()
            login(request, user)
            return redirect('post_list')
    else:
        form = UserCreationForm()
    return render(request, 'registration/register.html', {'form': form})


class PostListView(ListView):
    model = Post
    template_name = 'posts/post_list.html'
    context_object_name = 'posts'
    ordering = ['-created_at']

    def get_queryset(self):
        queryset = super().get_queryset()
        query = self.request.GET.get('q')
        if query:
            queryset = queryset.filter(
                Q(title__icontains=query) | Q(content__icontains=query)
            )
        return queryset

    def get_context_data(self, **kwargs):
        context = super().get_context_data(**kwargs)
        context['query'] = self.request.GET.get('q', '')
        return context


class PostDetailView(DetailView):
    model = Post
    template_name = 'posts/post_detail.html'
    context_object_name = 'post'

    def get_context_data(self, **kwargs):
        context = super().get_context_data(**kwargs)
        context['comments'] = self.object.comments.all()
        context['form'] = CommentForm()
        
        is_liked = False
        if self.request.user.is_authenticated:
            if self.object.likes.filter(user=self.request.user).exists():
                is_liked = True
        context['is_liked'] = is_liked
        return context

    
    def post(self, request, *args, **kwargs):
        if not request.user.is_authenticated:
            return redirect('login')
            
        self.object = self.get_object()
        form = CommentForm(request.POST)
        
        if form.is_valid():
            comment = form.save(commit=False)
            comment.post = self.object
            comment.author = request.user
            comment.save()
            return redirect('post_detail', pk=self.object.pk)
        
        context = self.get_context_data(object=self.object)
        context['form'] = form
        return self.render_to_response(context)

class PostCreateView(LoginRequiredMixin, CreateView):
    model = Post
    form_class = PostForm
    template_name = 'posts/post_form.html'
    success_url = reverse_lazy('post_list')

    def form_valid(self, form):
        form.instance.author = self.request.user
        return super().form_valid(form)

class PostUpdateView(LoginRequiredMixin, UserPassesTestMixin, UpdateView):
    model = Post
    form_class = PostForm
    template_name = 'posts/post_form.html'
    
    def get_context_data(self, **kwargs):
        context = super().get_context_data(**kwargs)
        context['is_edit'] = True 
        return context

    def test_func(self):
        post = self.get_object()
        return self.request.user == post.author

    def get_success_url(self):
        return reverse_lazy('post_detail', kwargs={'pk': self.object.pk})


class PostDeleteView(LoginRequiredMixin, UserPassesTestMixin, DeleteView):
    model = Post
    success_url = reverse_lazy('post_list')
    template_name = 'posts/post_confirm_delete.html' 

    def test_func(self):
        post = self.get_object()
        return self.request.user == post.author
    
    def get(self, request, *args, **kwargs):
        return self.post(request, *args, **kwargs)


def like_post(request, pk):
    post = get_object_or_404(Post, pk=pk)
    if request.user.is_authenticated:
        like, created = Like.objects.get_or_create(user=request.user, post=post)
        if not created:
            like.delete()
    return redirect('post_detail', pk=pk)
</file>

<file path="moj_projekt/urls.py">
from django.contrib import admin
from django.urls import path
from django.contrib.auth import views as auth_views 
from moj_app import views 
from moj_app.views import (
    PostListView, 
    PostDetailView, 
    PostCreateView, 
    PostUpdateView, 
    PostDeleteView
)

urlpatterns = [
    path('admin/', admin.site.urls),
    
    path('register/', views.register, name='register'),
    path('login/', auth_views.LoginView.as_view(template_name='registration/login.html'), name='login'),
    path('logout/', auth_views.LogoutView.as_view(), name='logout'),

    path('', PostListView.as_view(), name='post_list'), 
    path('post/<int:pk>/', PostDetailView.as_view(), name='post_detail'),
    path('post/new/', PostCreateView.as_view(), name='post_create'),
    path('post/<int:pk>/edit/', PostUpdateView.as_view(), name='post_edit'),
    path('post/<int:pk>/delete/', PostDeleteView.as_view(), name='post_delete'),
    
    path('post/<int:pk>/like/', views.like_post, name='like_post'),
]
</file>

</files>
